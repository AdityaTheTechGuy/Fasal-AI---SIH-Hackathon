<!DOCTYPE html>
<html lang="{{ get_locale() }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fasal AI - {{ _('AI Crop Recommendation System') }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="language-selector">
        <select id="language-select" onchange="window.location.href = '/change-lang/' + this.value;"
            aria-label="{{ _('Select Language') }}">
            {% for lang_code, lang_name in languages.items() %}
            <option value="{{ lang_code }}" {% if get_locale()|string==lang_code %}selected{% endif %}>
                {{ lang_name }}
            </option>
            {% endfor %}
        </select>
        <button class="btn btn--icon" onclick="playText('current-text')" title="{{ _('Listen') }}">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- Error message container for JavaScript errors -->
    <div id="error-message" class="alert alert--error" style="display: none;"></div>

    <header class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1><img src="{{ url_for('static', filename='logo.png') }}" alt="FasalAI Logo" class="hero-logo"></h1>


                    <h2>{{ _('Smart Crop Recommendation System') }}</h2>
                    <p>{{ _('Smart India Hackathon 2025 - Revolutionizing Agriculture with Artificial Intelligence') }}
                    </p>
                    <p class="hero-description" id="current-text">{{ _('Get personalized crop recommendations based on
                        soil nutrients,
                        climate conditions, and advanced machine learning algorithms. Make informed farming decisions
                        with 98.18%% accuracy.') }}</p>
                    <button class="btn btn--primary" onclick="scrollToForm()">
                        <i class="fas fa-chart-line"></i> {{ _('Start Analysis') }}
                    </button>
                </div>
                <div class="hero-visual">
                    <div class="hero-stats">
                        <div class="stat-card">
                            <i class="fas fa-brain"></i>
                            <h3>{{_('98.18%%') }}</h3>
                            <p>{{ _('AI Accuracy') }}</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-leaf"></i>
                            <h3>{{ _('22+') }}</h3>
                            <p>{{ _('Crop Types') }}</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-globe"></i>
                            <h3>7</h3>
                            <p>{{ _('Parameters') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Live Prediction Section -->
    <section class="input-section">
        <div class="container">
            <h2><i class="fas fa-location-dot"></i> {{ _('Live Location-Based Recommendation') }}</h2>
            <p class="section-description">{{ _('Get instant crop recommendations based on your current location and real-time data from OpenWeatherMap and SoilGrids APIs') }}</p>

            <div class="live-prediction-card">
                <div class="live-prediction-content">
                    <div class="live-prediction-info">
                        <i class="fas fa-satellite"></i>
                        <h3>{{ _('Real-time Analysis') }}</h3>
                        <p>{{ _('Our system analyzes current weather conditions from OpenWeatherMap and soil data from SoilGrids to provide the most accurate recommendation.') }}</p>
                    </div>
                    
                    <div class="live-prediction-action">
                        <button id="getLocationBtn" class="btn btn--primary btn--lg">
                            <i class="fas fa-location-crosshairs"></i>
                            {{ _('Get Recommendation For My Location') }}
                        </button>
                        <p class="privacy-note">
                            <i class="fas fa-shield-alt"></i>
                            {{ _('Your location data is only used for crop recommendation and is not stored.') }}
                        </p>
                    </div>
                </div>
                
                <div id="live-result" class="live-result"></div>
            </div>
        </div>
    </section>

    <section class="input-section" id="input-form">
        <div class="container">
            <h2><i class="fas fa-sliders-h"></i>{{ _('Manual Soil & Climate Analysis') }}</h2>
            <p class="section-description">{{ _('Adjust the parameters below to get personalized crop recommendations')
                }}</p>

            <form method="POST" action="{{ url_for('predict') }}" id="crop-prediction-form">
                <div class="form-grid">
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-flask"></i>
                                <h3>{{ _('Nitrogen') }} </h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">{{ _('Essential for vegetative growth and chlorophyll
                                formation') }}</p>
                            <div class="input-group">
                                <input type="range" id="nitrogen" name="nitrogen" min="0" max="200"
                                    value="{{ input_values.nitrogen if input_values else 50 }}" class="slider">
                                <input type="number" id="nitrogen-input" min="0" max="200"
                                    value="{{ input_values.nitrogen if input_values else 50 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-seedling"></i>
                                <h3>{{ _('Phosphorus') }} (P)</h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">{{ _('Important for root development and flowering') }}</p>
                            <div class="input-group">
                                <input type="range" id="phosphorus" name="phosphorus" min="0" max="150"
                                    value="{{ input_values.phosphorus if input_values else 30 }}" class="slider">
                                <input type="number" id="phosphorus-input" min="0" max="150"
                                    value="{{ input_values.phosphorus if input_values else 30 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-shield-alt"></i>
                                <h3>{{ _('Potassium') }} (K)</h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">{{ _('Enhances disease resistance and fruit quality')}}</p>
                            <div class="input-group">
                                <input type="range" id="potassium" name="potassium" min="0" max="300"
                                    value="{{ input_values.potassium if input_values else 40 }}" class="slider">
                                <input type="number" id="potassium-input" min="0" max="300"
                                    value="{{ input_values.potassium if input_values else 40 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-thermometer-half"></i>
                                <h3>{{ _('Temperature')}}</h3>
                                <span class="parameter-unit">Â°C</span>
                            </div>
                            <p class="parameter-description">{{ _('Average growing season temperature') }}</p>
                            <div class="input-group">
                                <input type="range" id="temperature" name="temperature" min="5" max="45"
                                    value="{{ input_values.temperature if input_values else 25 }}" class="slider">
                                <input type="number" id="temperature-input" min="5" max="45"
                                    value="{{ input_values.temperature if input_values else 25 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-tint"></i>
                                <h3>{{ _('Humidity') }}</h3>
                                <span class="parameter-unit">%</span>
                            </div>
                            <p class="parameter-description">{{ _('Relative humidity levels') }}</p>
                            <div class="input-group">
                                <input type="range" id="humidity" name="humidity" min="10" max="100"
                                    value="{{ input_values.humidity if input_values else 60 }}" class="slider">
                                <input type="number" id="humidity-input" min="10" max="100"
                                    value="{{ input_values.humidity if input_values else 60 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-balance-scale"></i>
                                <h3>{{ _('pH Level') }}</h3>
                                <span class="parameter-unit">pH</span>
                            </div>
                            <p class="parameter-description">{{ _('Soil acidity/alkalinity level') }}</p>
                            <div class="input-group">
                                <input type="range" id="ph" name="ph" min="3" max="10" step="0.1"
                                    value="{{ input_values.ph if input_values else 6.5 }}" class="slider">
                                <input type="number" id="ph-input" min="3" max="10" step="0.1"
                                    value="{{ input_values.ph if input_values else 6.5 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-cloud-rain"></i>
                                <h3>{{ _('Rainfall') }}</h3>
                                <span class="parameter-unit">mm</span>
                            </div>
                            <p class="parameter-description">{{ _('Annual precipitation') }}</p>
                            <div class="input-group">
                                <input type="range" id="rainfall" name="rainfall" min="200" max="3000"
                                    value="{{ input_values.rainfall if input_values else 1000 }}" class="slider">
                                <input type="number" id="rainfall-input" min="200" max="3000"
                                    value="{{ input_values.rainfall if input_values else 1000 }}" class="number-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-submit-section" style="text-align: center; margin-top: 2rem; padding: 1rem;">
                    <button type="submit" class="btn btn--primary btn--lg">
                        <i class="fas fa-seedling"></i> {{ _('Get Recommendation') }}
                    </button>
                    <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: 0.5rem;">
                        {{ _('Click to analyze soil conditions and get AI-powered crop recommendations') }}
                    </p>
                </div>
            </form>
        </div>
    </section>

    {% if error %}
    <section class="message-section" style="padding: 1rem 0; background-color: var(--color-bg-4);">
        <div class="container">
            <div class="alert alert--error"
                style="background: rgba(var(--color-error-rgb), 0.1); border: 1px solid rgba(var(--color-error-rgb), 0.3); border-radius: var(--radius-base); padding: 1rem; color: var(--color-error);">
                <i class="fas fa-exclamation-circle"></i>
                <strong>{{ _('Error:') }}</strong> {{ error }}
            </div>
        </div>
    </section>
    {% endif %}

    <section class="results-section" id="results" style="display: none;">
        <div class="container">
            <h2><i class="fas fa-chart-bar"></i> {{ _('AI Recommendations') }}</h2>

            <div class="results-grid">
                <div class="primary-recommendation">
                    <div class="card">
                        <div class="card__body">
                            <div class="primary-crop-header">
                                <h3>{{ _('Best Crop Recommendation') }}</h3>
                                <div class="confidence-badge">
                                    <span id="primary-confidence">0%</span> {{ _('Confidence') }}
                                </div>
                            </div>
                            <div class="primary-crop-content">
                                <div class="crop-icon" id="primary-crop-icon">ðŸŒ±</div>
                                <div class="crop-details">
                                    <h2 id="primary-crop-name">{{ _('Select parameters to see recommendations') }}</h2>
                                    <div class="crop-info-grid">
                                        <div class="info-item">
                                            <i class="fas fa-calendar"></i>
                                            <span id="primary-crop-season">{{ _('Adjust sliders to see data') }}</span>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-tint"></i>
                                            <span id="primary-crop-water">{{ _('Adjust sliders to see data') }}</span>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-mountain"></i>
                                            <span id="primary-crop-soil">{{ _('Adjust sliders to see data') }}</span>
                                        </div>
                                    </div>
                                    <div class="crop-tips">
                                        <h4><i class="fas fa-lightbulb"></i> {{ _('Growing Tips') }}</h4>
                                        <p id="primary-crop-tips">{{ _('Adjust the parameters above to get personalized
                                            growing tips for your recommended crop.') }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alternative-recommendations">
                    <h3>{{ _('Alternative Recommendations') }}</h3>
                    <div id="alternative-crops" class="alternative-grid">
                        <div class="alternative-crop">
                            <div class="alternative-crop-icon">ðŸŒ½</div>
                            <h4>{{ _('Maize') }}</h4>
                            <div class="alternative-confidence confidence-medium">75% {{ _('Match') }}</div>
                            <p>{{ _('Kharif/Rabi season crop') }}</p>
                        </div>
                        <div class="alternative-crop">
                            <div class="alternative-crop-icon">ðŸ«˜</div>
                            <h4>{{ _('Chickpea') }}</h4>
                            <div class="alternative-confidence confidence-medium">68% {{ _('Match') }}</div>
                            <p>{{ _('Rabi season crop') }}</p>
                        </div>
                        <div class="alternative-crop">
                            <div class="alternative-crop-icon">ðŸŒ±</div>
                            <h4>{{ _('Cotton') }}</h4>
                            <div class="alternative-confidence confidence-low">52% {{ _('Match') }}</div>
                            <p>{{ _('Kharif season crop') }}</p>
                        </div>
                    </div>
                </div>

                <div class="chart-container" style="position: relative; height: 300px;">
                    <canvas id="suitabilityChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <section class="education-section">
        <div class="container">
            <h2><i class="fas fa-graduation-cap"></i> {{ _('Agricultural Knowledge') }}</h2>
            <div class="education-grid">
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-flask"></i>
                            <h3>{{ _('Soil Nutrients') }}</h3>
                            <p>{{ _('Learn about the essential nutrients required for optimal crop growth and how to
                                maintain soil health.') }}</p>
                        </div>
                    </div>
                </div>
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-cloud-sun"></i>
                            <h3>{{ _('Climate Impact') }}</h3>
                            <p>{{ _('Understand how temperature, humidity, and rainfall affect different crops and
                                farming practices.') }}</p>
                        </div>
                    </div>
                </div>
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-seedling"></i>
                            <h3>{{ _('Crop Rotation') }}</h3>
                            <p>{{ _('Discover the benefits of crop rotation and how it improves soil fertility and
                                reduces pests.') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-seedling"></i> FasalAI</h3>
                    <p>{{ _('Revolutionizing agriculture with AI-powered crop recommendations for better farming
                        decisions.') }}</p>
                </div>
                <div class="footer-section">
                    <h4>{{ _('Quick Links') }}</h4>
                    <ul>
                        <li><a href="#input-form">{{ _('Crop Analysis') }}</a></li>
                        <li><a href="#results">{{ _('Recommendations') }}</a></li>
                        <li><a href="#">{{ _('About Us') }}</a></li>
                        <li><a href="#">{{ _('Contact') }}</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>{{ _('Supported Crops') }}</h4>
                    <p>{{ _('Rice, Maize, Cotton, Apple, Banana, Coffee, and 16+ more crops with detailed growing
                        information.') }}</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FasalAI - {{ _('Smart India Hackathon Project. All rights reserved.') }}</p>
            </div>
        </div>
    </footer>

    <!-- Chatbot Widget -->
    <div id="chatbot" class="chatbot">
        <button id="chat-toggle" class="chat-toggle" aria-label="Open chat">
            <i class="fas fa-comments"></i>
        </button>
        <div id="chat-panel" class="chat-panel" aria-live="polite" aria-hidden="true">
            <div class="chat-header">
                <div class="chat-title"><i class="fas fa-seedling"></i> FasalAI Assistant</div>
                <button id="chat-close" class="chat-close" aria-label="Close chat">&times;</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <form id="chat-form" class="chat-input" autocomplete="off">
                <input id="chat-input" type="text" placeholder="Ask about crops, soil, pests..." aria-label="Chat input" required>
                <button type="submit" class="btn btn--primary"><i class="fas fa-paper-plane"></i></button>
            </form>
        </div>
    </div>

    <style>
    .chatbot{position:fixed;right:16px;bottom:16px;z-index:1000}
    .chat-toggle{width:56px;height:56px;border-radius:50%;border:none;background:#1FB8CD;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.2);cursor:pointer;font-size:22px}
    .chat-panel{position:fixed;right:16px;bottom:84px;width:320px;max-height:60vh;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.15);display:none;flex-direction:column;overflow:hidden}
    .chat-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#f8fafc;border-bottom:1px solid #e5e7eb}
    .chat-title{font-weight:600}
    .chat-close{background:transparent;border:none;font-size:20px;cursor:pointer}
    .chat-messages{padding:10px;overflow:auto;max-height:42vh;display:flex;flex-direction:column;gap:8px}
    .chat-msg{padding:8px 10px;border-radius:10px;max-width:85%}
    .chat-msg.user{align-self:flex-end;background:#e0f7fa}
    .chat-msg.bot{align-self:flex-start;background:#f1f5f9}
    .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid #e5e7eb}
    .chat-input input{flex:1;padding:8px 10px;border:1px solid #e5e7eb;border-radius:8px}
    </style>

    <script>
    window.I18N = {
      fetching_location: "{{ _('Fetching your location...') }}",
      location_found_analyzing: "{{ _('Location found! Analyzing soil and climate data...') }}",
      live_recommendation: "{{ _('Live Recommendation') }}",
      confidence: "{{ _('Confidence') }}",
      season: "{{ _('Season') }}",
      water_requirement: "{{ _('Water Requirement') }}",
      soil_type: "{{ _('Soil Type') }}",
      growing_tips: "{{ _('Growing Tips') }}",
      location: "{{ _('Location') }}",
      data_sources: "{{ _('Data Sources: OpenWeatherMap + SoilGrids API') }}",
      error: "{{ _('Error') }}",
      error_processing_request: "{{ _('An error occurred while processing your request.') }}",
      network_error_try_again: "{{ _('Network error. Please try again.') }}",
      analyzing: "{{ _('Analyzing...') }}",
      suitability_score: "{{ _('Suitability Score') }}",
      suitability_chart_title: "{{ _('Crop Suitability Analysis') }}",
      suitability_score_pct: "{{ _('Suitability Score (%%)') }}",
      crops_label: "{{ _('Crops') }}",
      live_data_badge: "{{ _('Live data') }}",
      using_live_data_note: "{{ _('Using live soil & weather data') }}",
      share_title: "{{ _('Crop Recommendation') }}",
      share_fallback: "{{ _('Share this recommendation:') }}",
      confidence_label: "{{ _('confidence') }}",
      geolocation_not_supported: "{{ _('Geolocation is not supported by your browser.') }}",
      geolocation_denied: "{{ _('Location access was denied. Please enable location permissions.') }}",
      geolocation_unavailable: "{{ _('Location information is unavailable.') }}",
      geolocation_timeout: "{{ _('Location request timed out.') }}",
      geolocation_unknown: "{{ _('An unknown error occurred.') }}"
    };
    </script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>