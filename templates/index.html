<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fasal AI - AI Crop Recommendation System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Webfonts for better multilingual rendering -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Noto Sans + Noto Sans Devanagari (covers Hindi/Bhojpuri/Marathi) + Noto Sans Bengali/ Gujarati/ Oriya fallbacks -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&family=Noto+Sans+Devanagari:wght@400;700&family=Noto+Sans+Bengali:wght@400;700&family=Noto+Sans+Gujarati:wght@400;700&family=Noto+Sans+Oriya:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,hi,gu,bn,or,bho',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
</head>

<!-- Helper: mark document when Google Translate has translated content so CSS can target it -->
<script>
    (function () {
        function markTranslated() {
            try {
                var htmlLang = document.documentElement.getAttribute('lang') || '';
                if (htmlLang && htmlLang.toLowerCase() !== 'en') {
                    document.body.classList.add('translated');
                } else {
                    document.body.classList.remove('translated');
                }
            } catch (e) {
                // ignore
            }
        }

        // Observe changes to the html lang attribute (Google Translate toggles it)
        var observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (m) {
                if (m.attributeName === 'lang') markTranslated();
            });
        });

        if (document.documentElement) {
            observer.observe(document.documentElement, { attributes: true });
        }

        // Run once on load
        document.addEventListener('DOMContentLoaded', function () {
            markTranslated();
        });
    })();
</script>

<body>
    <div class="language-selector">
        <div id="google_translate_element"></div>
        <button class="btn btn--icon" onclick="playText('current-text')" title="Listen">
            <i class="fas fa-volume-up"></i>
        </button>
    </div>

    <!-- Error message container for JavaScript errors -->
    <div id="error-message" class="alert alert--error" style="display: none;"></div>

    <header class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1><img src="{{ url_for('static', filename='logo.png') }}" alt="FasalAI Logo" class="hero-logo">
                    </h1>

                    <h2>Smart Crop Recommendation System</h2>
                    <p>Smart India Hackathon 2025 - Revolutionizing Agriculture with Artificial Intelligence</p>
                    <p class="hero-description" id="current-text">Get personalized crop recommendations based on
                        soil nutrients, climate conditions, and advanced machine learning algorithms. Make informed
                        farming decisions with 98.18% accuracy.</p>
                    <button class="btn btn--primary" onclick="scrollToForm()">
                        <i class="fas fa-chart-line"></i> Start Analysis
                    </button>
                </div>
                <div class="hero-visual">
                    <div class="hero-stats">
                        <div class="stat-card">
                            <i class="fas fa-brain"></i>
                            <h3>98.18%</h3>
                            <p>AI Accuracy</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-leaf"></i>
                            <h3>22+</h3>
                            <p>Crop Types</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-globe"></i>
                            <h3>7</h3>
                            <p>Parameters</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Live Prediction Section -->
    <section class="input-section">
        <div class="container">
            <h2><i class="fas fa-location-dot"></i> Live Location-Based Recommendation</h2>
            <p class="section-description">Get instant crop recommendations based on your current location and
                real-time data from OpenWeatherMap and SoilGrids APIs</p>

            <div class="live-prediction-card">
                <div class="live-prediction-content">
                    <div class="live-prediction-info">
                        <i class="fas fa-satellite"></i>
                        <h3>Real-time Analysis</h3>
                        <p>Our system analyzes current weather conditions from OpenWeatherMap and soil data from
                            SoilGrids to provide the most accurate recommendation.</p>
                    </div>

                    <div class="live-prediction-action">
                        <button id="getLocationBtn" class="btn btn--primary btn--lg">
                            <i class="fas fa-location-crosshairs"></i>
                            Get Recommendation For My Location
                        </button>
                        <p class="privacy-note">
                            <i class="fas fa-shield-alt"></i>
                            Your location data is only used for crop recommendation and is not stored.
                        </p>
                    </div>
                </div>

                <div id="live-result" class="live-result"></div>
            </div>
        </div>
    </section>

    <section class="input-section" id="input-form">
        <div class="container">
            <h2><i class="fas fa-sliders-h"></i>Manual Soil & Climate Analysis</h2>
            <p class="section-description">Adjust the parameters below to get personalized crop recommendations</p>

            <form method="POST" action="{{ url_for('predict') }}" id="crop-prediction-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <div class="form-grid">
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-flask"></i>
                                <h3>Nitrogen </h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">Essential for vegetative growth and chlorophyll
                                formation</p>
                            <div class="input-group">
                                <input type="range" id="nitrogen" name="nitrogen" min="0" max="200"
                                    value="{{ input_values.nitrogen if input_values else 50 }}" class="slider"
                                    aria-label="Nitrogen content slider in kg per hectare">
                                <input type="number" id="nitrogen-input" min="0" max="200"
                                    value="{{ input_values.nitrogen if input_values else 50 }}" class="number-input"
                                    aria-label="Nitrogen content input in kg per hectare">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-seedling"></i>
                                <h3>Phosphorus (P)</h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">Important for root development and flowering</p>
                            <div class="input-group">
                                <input type="range" id="phosphorus" name="phosphorus" min="0" max="150"
                                    value="{{ input_values.phosphorus if input_values else 30 }}" class="slider"
                                    aria-label="Phosphorus content slider in kg per hectare">
                                <input type="number" id="phosphorus-input" min="0" max="150"
                                    value="{{ input_values.phosphorus if input_values else 30 }}" class="number-input"
                                    aria-label="Phosphorus content input in kg per hectare">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-shield-alt"></i>
                                <h3>Potassium (K)</h3>
                                <span class="parameter-unit">kg/ha</span>
                            </div>
                            <p class="parameter-description">Enhances disease resistance and fruit quality</p>
                            <div class="input-group">
                                <input type="range" id="potassium" name="potassium" min="0" max="300"
                                    value="{{ input_values.potassium if input_values else 40 }}" class="slider"
                                    aria-label="Potassium content slider in kg per hectare">
                                <input type="number" id="potassium-input" min="0" max="300"
                                    value="{{ input_values.potassium if input_values else 40 }}" class="number-input"
                                    aria-label="Potassium content input in kg per hectare">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-thermometer-half"></i>
                                <h3>Temperature</h3>
                                <span class="parameter-unit">°C</span>
                            </div>
                            <p class="parameter-description">Average growing season temperature</p>
                            <div class="input-group">
                                <input type="range" id="temperature" name="temperature" min="5" max="45"
                                    value="{{ input_values.temperature if input_values else 25 }}" class="slider"
                                    aria-label="Temperature slider in Celsius">
                                <input type="number" id="temperature-input" min="5" max="45"
                                    value="{{ input_values.temperature if input_values else 25 }}" class="number-input"
                                    aria-label="Temperature input in Celsius">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-tint"></i>
                                <h3>Humidity</h3>
                                <span class="parameter-unit">%</span>
                            </div>
                            <p class="parameter-description">Relative humidity levels</p>
                            <div class="input-group">
                                <input type="range" id="humidity" name="humidity" min="10" max="100"
                                    value="{{ input_values.humidity if input_values else 60 }}" class="slider"
                                    aria-label="Humidity slider in percentage">
                                <input type="number" id="humidity-input" min="10" max="100"
                                    value="{{ input_values.humidity if input_values else 60 }}" class="number-input"
                                    aria-label="Humidity input in percentage">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-balance-scale"></i>
                                <h3>pH Level</h3>
                                <span class="parameter-unit">pH</span>
                            </div>
                            <p class="parameter-description">Soil acidity/alkalinity level</p>
                            <div class="input-group">
                                <input type="range" id="ph" name="ph" min="3" max="10" step="0.1"
                                    value="{{ input_values.ph if input_values else 6.5 }}" class="slider"
                                    aria-label="Soil pH slider">
                                <input type="number" id="ph-input" min="3" max="10" step="0.1"
                                    value="{{ input_values.ph if input_values else 6.5 }}" class="number-input"
                                    aria-label="Soil pH input">
                            </div>
                        </div>
                    </div>
                    <div class="parameter-group">
                        <div class="parameter-card">
                            <div class="parameter-header">
                                <i class="fas fa-cloud-rain"></i>
                                <h3>Rainfall</h3>
                                <span class="parameter-unit">mm</span>
                            </div>
                            <p class="parameter-description">Annual precipitation</p>
                            <div class="input-group">
                                <input type="range" id="rainfall" name="rainfall" min="200" max="3000"
                                    value="{{ input_values.rainfall if input_values else 1000 }}" class="slider"
                                    aria-label="Annual rainfall slider in millimeters">
                                <input type="number" id="rainfall-input" min="200" max="3000"
                                    value="{{ input_values.rainfall if input_values else 1000 }}" class="number-input"
                                    aria-label="Annual rainfall input in millimeters">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-submit-section" style="text-align: center; margin-top: 2rem; padding: 1rem;">
                    <button type="submit" class="btn btn--primary btn--lg">
                        <i class="fas fa-seedling"></i> Get Recommendation
                    </button>
                    <p style="font-size: 0.875rem; color: var(--color-text-secondary); margin-top: 0.5rem;">
                        Click to analyze soil conditions and get AI-powered crop recommendations
                    </p>
                </div>
            </form>
        </div>
    </section>

    <section class="results-section {% if prediction %}visible{% endif %}" id="results">
        <div class="container">
            <h2><i class="fas fa-chart-bar"></i> AI Recommendations</h2>

            <div class="results-grid">
                <div class="primary-recommendation">
                    <div class="card">
                        <div class="card__body">
                            <div class="primary-crop-header">
                                <h3>Best Crop Recommendation</h3>
                                <div class="confidence-badge">
                                    <span id="primary-confidence">{{ confidence|default(0) }}%</span> {{ 'Confidence' }}
                                </div>
                            </div>
                            <div class="primary-crop-content">
                                <div class="crop-icon" id="primary-crop-icon">🌱</div>
                                <div class="crop-details">
                                    <h2 id="primary-crop-name">{{ prediction|default('Select parameters to see
                                        recommendations') }}</h2>
                                    <div class="crop-info-grid">
                                        <div class="info-item">
                                            <i class="fas fa-calendar"></i>
                                            <span id="primary-crop-season">{{ (crop_info.season) if crop_info else
                                                'Adjust
                                                sliders to see data' }}</span>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-tint"></i>
                                            <span id="primary-crop-water">{{ (crop_info.water_req) if crop_info else
                                                'Adjust
                                                sliders to see data' }}</span>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-mountain"></i>
                                            <span id="primary-crop-soil">{{ (crop_info.soil_type) if crop_info else
                                                'Adjust
                                                sliders to see data' }}</span>
                                        </div>
                                    </div>
                                    <div class="crop-tips">
                                        <h4><i class="fas fa-lightbulb"></i> Growing Tips</h4>
                                        <p id="primary-crop-tips">{{ (crop_info.tips) if crop_info else 'Adjust the
                                            parameters above to get personalized growing tips for your recommended
                                            crop.' }}
                                        </p>
                                    </div>
                                    {% if market_data %}
                                    <div class="market-info">
                                        <h4><i class="fas fa-chart-line"></i> Market Information</h4>
                                        <div class="info-item">
                                            <i class="fas fa-rupee-sign"></i>
                                            <span>Current Price Range: ₹{{ market_data.price_range }}/{{
                                                market_data.unit }}</span>
                                        </div>
                                        <div class="info-item">
                                            <i class="fas fa-balance-scale"></i>
                                            <span>Expected Yield: {{ market_data.yield_per_hectare }} {{
                                                market_data.unit }}/ha</span>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alternative-recommendations">
                    <h3>Alternative Recommendations</h3>
                    <div id="alternative-crops" class="alternative-grid">
                        {% if alternative_predictions %}
                        {% for alt in alternative_predictions %}
                        <div class="alternative-crop">
                            <div class="alternative-crop-icon">🌱</div>
                            <h4>{{ alt.crop }}</h4>
                            <div
                                class="alternative-confidence confidence-{% if alt.confidence >= 70 %}high{% elif alt.confidence >= 40 %}medium{% else %}low{% endif %}">
                                {{ alt.confidence }}% Match
                            </div>
                            {% set crop_info_alt = findCropEntry(alt.crop)[0] %}
                            <p>{{ crop_info_alt.season }}</p>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="alternative-crop">
                            <div class="alternative-crop-icon">🌱</div>
                            <h4>No alternatives</h4>
                            <div class="alternative-confidence confidence-low">0% Match</div>
                            <p>No alternative crops found</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="chart-container" style="position: relative; height: 300px;">
                <canvas id="suitabilityChart"></canvas>
            </div>
        </div>
    </section>

    <section class="education-section">
        <div class="container">
            <h2><i class="fas fa-graduation-cap"></i> Agricultural Knowledge</h2>
            <div class="education-grid">
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-flask"></i>
                            <h3>Soil Nutrients</h3>
                            <p>Learn about the essential nutrients required for optimal crop growth and how to maintain
                                soil health.</p>
                        </div>
                    </div>
                </div>
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-cloud-sun"></i>
                            <h3>Climate Impact</h3>
                            <p>Understand how temperature, humidity, and rainfall affect different crops and farming
                                practices.</p>
                        </div>
                    </div>
                </div>
                <div class="education-card">
                    <div class="card">
                        <div class="card__body">
                            <i class="fas fa-seedling"></i>
                            <h3>Crop Rotation</h3>
                            <p>Discover the benefits of crop rotation and how it improves soil fertility and reduces
                                pests.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-seedling"></i> FasalAI</h3>
                    <p>Revolutionizing agriculture with AI-powered crop recommendations for better farming decisions.
                    </p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#input-form">Crop Analysis</a></li>
                        <li><a href="#results">Recommendations</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Supported Crops</h4>
                    <p>Rice, Maize, Cotton, Apple, Banana, Coffee, and 16+ more crops with detailed growing information.
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FasalAI - Smart India Hackathon Project. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Chatbot Widget -->
    <div id="chatbot" class="chatbot">
        <button id="chat-toggle" class="chat-toggle" aria-label="Open chat">
            <i class="fas fa-comments"></i>
        </button>
        <div id="chat-panel" class="chat-panel" aria-live="polite" aria-hidden="true">
            <div class="chat-header">
                <div class="chat-title"><i class="fas fa-seedling"></i> FasalAI Assistant</div>
                <button id="chat-close" class="chat-close" aria-label="Close chat">&times;</button>
            </div>
            <div id="chat-messages" class="chat-messages"></div>
            <form id="chat-form" class="chat-input" autocomplete="off">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input id="chat-input" type="text" placeholder="Ask about crops, soil, pests..." aria-label="Chat input"
                    required>
                <button type="submit" class="btn btn--primary" aria-label="Send message"><i
                        class="fas fa-paper-plane"></i></button>
            </form>
        </div>
    </div>

    <script>
        // Chart configuration
        function updateSuitabilityChart(mainCrop, alternatives) {
            const ctx = document.getElementById('suitabilityChart').getContext('2d');
            const crops = [mainCrop, ...alternatives].map(c => c.crop);
            const scores = [mainCrop, ...alternatives].map(c => c.confidence);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: crops,
                    datasets: [{
                        label: 'Crop Suitability Score',
                        data: scores,
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',  // Main crop (green)
                            'rgba(59, 130, 246, 0.6)',  // Alternative 1 (blue)
                            'rgba(245, 158, 11, 0.6)',  // Alternative 2 (orange)
                        ],
                        borderColor: [
                            'rgba(16, 185, 129, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(245, 158, 11, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparative Crop Analysis'
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '{{ confidence_label }}'
                            }
                        }
                    }
                }
            });
        }

        window.I18N = {
            fetching_location: "Fetching your location...",
            location_found_analyzing: "Location found! Analyzing soil and climate data...",
            live_recommendation: "Live Recommendation",
            confidence: "Confidence",
            season: "Season",
            water_requirement: "Water Requirement",
            soil_type: "Soil Type",
            growing_tips: "Growing Tips",
            location: "Location",
            data_sources: "Data Sources: OpenWeatherMap + SoilGrids API",
            error: "Error",
            error_processing_request: "An error occurred while processing your request.",
            network_error_try_again: "Network error. Please try again.",
            analyzing: "Analyzing...",
            suitability_score: "Suitability Score",
            suitability_chart_title: "Crop Suitability Analysis",
            suitability_score_pct: "Suitability Score (%)",
            crops_label: "Crops",
            live_data_badge: "Live data",
            using_live_data_note: "Using live soil & weather data",
            share_title: "Crop Recommendation",
            share_fallback: "Share this recommendation:",
            confidence_label: "confidence",
            geolocation_not_supported: "Geolocation is not supported by your browser.",
            geolocation_denied: "Location access was denied. Please enable location permissions.",
            geolocation_unavailable: "Location information is unavailable.",
            geolocation_timeout: "Location request timed out.",
            geolocation_unknown: "An unknown error occurred."
        };
    </script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>